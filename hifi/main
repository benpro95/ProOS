#!/bin/bash
###########################################################

## Read the 2nd Argument
ARG2=$2

## Read the 1st Argument
case "$1" in

boot)
## State Folder
rm -rf /var/lock/rpi
mkdir -p /var/lock/rpi
chmod -R 777 /var/lock/rpi
## Light Web Server
systemctl start lighttpd
## AirPlay Support
systemctl start rpi-airplay
## Bluetooth Audio
systemctl start hciuart
systemctl start bluetooth
systemctl start bt-agent@hci0
systemctl start bluealsa-aplay
## Attach Server SMB Share
if ping -c 1 10.177.1.4 > /dev/null 2> /dev/null
then
  systemctl start autofs
else
  echo "server not found."  
fi
## Auto Hotspot (on boot only)
sleep 60 # only run if bluetooth not connected
if [ ! -e /tmp/bt.connected ]; then
   systemctl start rpi-netdetect.service
fi
exit
;;

relax)
## Play sound in loop
systemctl stop rpi-relaxloop
systemctl set-environment rpi_relaxmode=$ARG2
systemctl start rpi-relaxloop
exit
;;

stoprelax)
systemctl stop rpi-relaxloop
exit
;;



        *)
          echo "HiFi System"
	      echo "  by Ben Provenzano III "
          exit 1
          ;;
    esac   
